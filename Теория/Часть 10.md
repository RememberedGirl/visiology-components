
# Промпт для генерации виджетов Visiology

## КРИТИЧЕСКИЕ ОСОБЕННОСТИ VISIOLOGY:

### 1. Структура данных (w объект):
```javascript
// Опишите структуру w.data.primaryData.items:
- keys: Array - измерения/группировки (например: ["Регион", "Город"])
- values: Array - числовые метрики (например: [1000, 50])  
- formattedKeys: Array - форматированные названия (например: ["Север", "Москва"])
- formattedValues: Array - форматированные значения (например: ["1,000", "50"])
- cols: Array - названия колонок (например: ["region", "city", "sales", "orders"])
- metadata: Array - описание метрик (dataType, columnType и т.д.)
```

### 2. Паттерн работы с фильтрами:
```javascript
// GET → SET → LISTEN паттерн:
const widgetGuid = w.general.renderTo;
let currentFilter = '';

// 1. GET - один раз при загрузке
const initialFilters = visApi().getSelectedValues(widgetGuid);
currentFilter = initialFilters?.[0]?.join(' - ') || '';

// 2. SET - при действии пользователя  
function handleClick(filterData) {
    const filterToSet = currentFilter === filterData ? [] : [filterData.split(' - ')];
    visApi().setFilterSelectedValues(widgetGuid, filterToSet);
}

// 3. LISTEN - для обновлений UI
visApi().onSelectedValuesChangedListener(
    {guid: widgetGuid + '-listener', widgetGuid: widgetGuid},
    (event) => {
        currentFilter = event.selectedValues?.[0]?.join(' - ') || '';
        updateVisualization();
    }
);
```

### 3. Создание контейнера:
```javascript
// Уникальный контейнер для избежания конфликтов:
w.general.text = `<div id="widget-${w.general.renderTo}" style="width:100%; height:100%;"></div>`;
TextRender({ text: w.general, style: {} });

// Использовать: document.getElementById(`widget-${w.general.renderTo}`)
```

## ВХОДНЫЕ ДАННЫЕ ДЛЯ ГЕНЕРАЦИИ:

### 1. Библиотека визуализации:
[Highcharts/ECharts/D3.js/Chart.js/Leaflet/Three.js/другая]

### 2. Тип визуализации:
[line/bar/pie/scatter/treemap/network/map/3d/etc]

### 3. Пример кода визуализации (чистый JavaScript):
```javascript
[Предоставьте рабочий пример с использованием выбранной библиотеки]
```

### 4. Преобразование данных:
[Как преобразовать w.data.primaryData.items в формат для визуализации?]

### 5. Интерактивность:
- Кликабельные элементы: [какие?]
- Данные для фильтра: [какие keys передавать?]
- Визуальное выделение: [как?]
- Toggle логика: [да/нет]

## ТРЕБУЕМЫЙ ВЫВОД:
Полный код виджета Visiology с соблюдением ВСЕХ особенностей платформы.
