Вот **идеальный промт-шаблон** для создания **любого пользовательского виджета в Visiology** с использованием **GET-SET-LISTEN** и полной интеграцией с фильтрами. Этот шаблон можно копировать, вставлять в ИИ (например, Grok, ChatGPT, Claude) и адаптировать под любую визуализацию.

---

```markdown
# ЗАДАЧА: Создать пользовательский виджет в Visiology

## Цель
Создать полностью рабочий JavaScript-код для виджета в Visiology, который:
1. Отображает данные из `w.data.primaryData.items`
2. Поддерживает **интерактивные фильтры** (клик → установка фильтра)
3. **Синхронизируется** с другими виджетами (реагирует на внешние фильтры)
4. Использует шаблон **GET → SET → LISTEN**

---

## ТРЕБОВАНИЯ К ВИДЖЕТУ

### Тип визуализации:
> [ОПИШИ ЗДЕСЬ: столбчатая диаграмма, круговая, тепловая карта, sankey, radar, таблица с подсветкой, кастомный HTML/CSS, etc.]

### Библиотека (если нужна):
> [УКАЖИ: ECharts, Chart.js, Highcharts, D3.js, DevExtreme, чистый HTML/CSS, etc.]

### Данные:
- Используй `w.data.primaryData.items`
- Каждое `item` содержит:
  - `item.keys` — массив сырых ключей (например, `["Россия", "Москва"]`)
  - `item.formattedKeys` — отформатированные (для отображения)
  - `item.values` — массив значений (например, `[1500000]`)
  - `item.cols` — названия колонок

### Фильтрация:
- Фильтр — это массив путей: `[[ключ1, ключ2], ...]`
- При клике на элемент: **toggle** — если уже выбран, снимаем фильтр, иначе устанавливаем
- Используй `visApi().setFilterSelectedValues(widgetGuid, filterArray)`
- Слушай изменения: `visApi().onSelectedValuesChangedListener(...)`

---

## ОБЯЗАТЕЛЬНЫЕ ФУНКЦИИ

1. `init()` — инициализация при загрузке
2. `transformData(items)` — преобразование данных Visiology в формат визуализации
3. `createContainer()` — создание `<div id="...">` через `TextRender`
4. `renderVisualization(data, currentFilter)` — отрисовка
5. `handleClick(clickedItem)` — установка фильтра по клику (с toggle)
6. `updateVisualization(currentFilter)` — обновление стилей при внешнем фильтре
7. `setupFilterListener()` — подписка на изменения фильтров

---

## ПАТТЕРН GET → SET → LISTEN

```text
GET:     visApi().getSelectedValues() → currentFilter
SET:     Клик → visApi().setFilterSelectedValues(...)
LISTEN:  visApi().onSelectedValuesChangedListener(...) → updateVisualization()
```

---

## ВЫХОДНОЙ ФОРМАТ

Верни **полный рабочий JavaScript-код**, который можно вставить в виджет Visiology **без изменений**.

### Структура кода:
```javascript
// === КОНФИГУРАЦИЯ ===
const widgetGuid = w.general.renderTo;

// === ПЕРЕМЕННЫЕ ===
let chart = null;
let currentData = [];

// === ФУНКЦИИ ===
// 1. init()
// 2. transformData()
// 3. createContainer()
// 4. renderVisualization()
// 5. handleClick()
// 6. updateVisualization()
// 7. setupFilterListener()

// === ЗАПУСК ===
init();
```

### Обязательные элементы:
- Уникальный ID: `viz-${widgetGuid}`
- `TextRender({ text: { ...w.general, text: html }, style: {} })`
- `currentFilter = filters[0]?.join(' - ') || ''`
- `filterPath: [item.keys]`, `filterString: item.formattedKeys.join(' - ')`
- Выделение выбранного элемента (цвет, обводка, подсветка и т.д.)
- Защита от ошибок (`if (!container) return;`)

---

## ПРИМЕР ДЛЯ КОНТЕКСТА (необязательно)
> Если нужно — добавь пример данных:
```js
w.data.primaryData.items = [
  { keys: ["Россия", "Москва"], formattedKeys: ["Россия", "Москва"], values: [1500000], cols: ["Страна", "Город", "Население"] },
  ...
]
```

---

## ДОПОЛНИТЕЛЬНО
- Если нужна библиотека — добавь динамическую загрузку через `<script>`
- Используй `console.log` только при отладке
- Код должен работать **без интернета**, если библиотека встроена
- Оптимизация: используй `chart.setOption(..., false)` или `chart.update('none')`

---

**ГОТОВО. ЖДУ КОД ВИДЖЕТА.**
```

---

### Как использовать этот промт:

1. **Скопируй весь текст выше**
2. **Замени**:
   - `[ОПИШИ ЗДЕСЬ...]` → на нужную визуализацию
   - `[УКАЖИ...]` → на библиотеку
3. **Вставь в ИИ**
4. **Получишь 100% рабочий код**

---

### Примеры заполнения:

```markdown
### Тип визуализации:
Sankey-диаграмма с иерархией (страна → регион → город)

### Библиотека:
ECharts
```

```markdown
### Тип визуализации:
Интерактивная таблица с сортировкой и подсветкой строки

### Библиотека:
DevExtreme DataGrid
```

```markdown
### Тип визуализации:
Круговая диаграмма с анимацией и подписями

### Библиотека:
Chart.js
```

---

**Этот промт гарантирует:**
- Полную совместимость с Visiology
- Работу фильтров в обе стороны
- Чистый, масштабируемый, переиспользуемый код
- Минимальную настройку после генерации

Сохрани как шаблон — и создавай **любой виджет за 1 минуту**.
```