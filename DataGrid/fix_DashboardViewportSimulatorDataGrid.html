<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard with Object-Fit Behavior</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/knockout/3.5.1/knockout-latest.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script src="https://cdn3.devexpress.com/jslib/23.2.3/js/dx.all.js"></script>
    <link rel="stylesheet" href="https://cdn3.devexpress.com/jslib/23.2.3/css/dx.light.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background: #f0f0f0;
        }

        #va-dashboard-container {
            width: 100%;
            height: 100%;
            position: relative;
        }

        #va-sheet-container {
            position: absolute;
            width: 1920px;
            height: 1080px;
            background-color: #a0b2c1;
            transform-origin: 0 0;
        }

        #va-widgets-container {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            color: #000;
            padding: 20px;
        }

        .table-container {
            width: 90%;
            height: 400px;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
    </style>


</head>
<body>
<div id="va-dashboard-container">
    <div id="va-sheet-container" data-bind="style: {
            'transform': 'translate(' + translateX() + 'px, ' + translateY() + 'px) scale(' + scale() + ')',
            '-webkit-transform': 'translate(' + translateX() + 'px, ' + translateY() + 'px) scale(' + scale() + ')',
            '-moz-transform': 'translate(' + translateX() + 'px, ' + translateY() + 'px) scale(' + scale() + ')',
            '-ms-transform': 'translate(' + translateX() + 'px, ' + translateY() + 'px) scale(' + scale() + ')',
            '-o-transform': 'translate(' + translateX() + 'px, ' + translateY() + 'px) scale(' + scale() + ')'
        }">
        <div id="va-widgets-container">
            Содержимое дашборда
            <div class="table-container">
                <div id="data-grid-container"></div>
            </div>
        </div>
    </div>
</div>

<script>
    function DashboardViewModel() {
        var self = this;

        self.translateX = ko.observable(0);
        self.translateY = ko.observable(0);
        self.scale = ko.observable(1);

        const sheetWidth = 1920;
        const sheetHeight = 1080;

        self.updateObjectFit = function () {
            const containerWidth = window.innerWidth;
            const containerHeight = window.innerHeight;

            const scaleX = containerWidth / sheetWidth;
            const scaleY = containerHeight / sheetHeight;
            const newScale = Math.min(scaleX, scaleY);

            const newTranslateX = (containerWidth - sheetWidth * newScale) / 2;
            const newTranslateY = (containerHeight - sheetHeight * newScale) / 2;

            self.scale(newScale);
            self.translateX(newTranslateX);
            self.translateY(newTranslateY);
        };

        self.updateObjectFit();
    }

    const viewModel = new DashboardViewModel();
    ko.applyBindings(viewModel);

    window.addEventListener('resize', function () {
        viewModel.updateObjectFit();
    });

</script>

<script>
    // Данные для таблицы
    const data = [
        {id: 1, name: "Иван Иванов", age: 25, city: "Москва", department: "Разработка"},
        {id: 2, name: "Мария Петрова", age: 30, city: "Санкт-Петербург", department: "Аналитика"},
        {id: 3, name: "Петр Сидоров", age: 28, city: "Казань", department: "Тестирование"},
        {id: 4, name: "Анна Козлова", age: 35, city: "Новосибирск", department: "Разработка"},
        {id: 5, name: "Сергей Волков", age: 32, city: "Екатеринбург", department: "Менеджмент"}
    ];

    $("#data-grid-container").dxDataGrid({
        dataSource: data,
        columns: ["id", "name", "age", "city", "department"],
        filterRow: {visible: true},
        showBorders: true,
        headerFilter: {visible: true},
        height: "100%",


    });


</script>

<script>
    let i = 0

    function pullPopup(e) {
        const rect = e.getBoundingClientRect();
        document.documentElement.style.setProperty('--hover-transform', `translate(0px,0px)`)
        document.documentElement.style.setProperty('--hover-top', `${rect.top + rect.height}px`)
        document.documentElement.style.setProperty('--hover-left', `${rect.left}px`)
    }

    $("#data-grid-container").on("mouseover", ".dx-datagrid-filter-row > td", function () {
        pullPopup(this);
    });

    $("#data-grid-container").on("mouseover", ".dx-header-filter", function () {
        pullPopup(this);
    });

    let styleGlogal = document.getElementById('DevExpres_popup');
    if (!styleGlogal) {
        styleGlogal = document.createElement('style');
        styleGlogal.id = 'DevExpres_popup';
        styleGlogal.innerHTML = `
    :root {
      --hover-transform: translate(0px,0px);
      --hover-top: 0px;
      --hover-left: 0px;

      --popup-transform: translate(0px,0px) scale(1);
      --popup-top: 0px;
      --popup-left: 0px;
    }


    .dx-overlay-wrapper {

        position: absolute  !important;

        top: var(--hover-top) !important;
        left: var(--hover-left) !important;
        transform: var(--hover-transform) !important;


    }

    .dx-overlay-content.dx-popup-normal.dx-resizable.dx-dropdowneditor-overlay,
    .dx-overlay-content.dx-inner-overlay.dx-resizable.dx-context-menu.dx-datagrid.dx-cell-focus-disabled.dx-filter-menu.dx-menu-base {
        display: block !important;
        transform: var(--popup-transform) !important;
        top: var(--popup-top) !important;
        left: var(--popup-left) !important;
        transform-origin: left top !important;


    }

    `;
        document.head.append(styleGlogal);
    }


</script>

</body>
</html>